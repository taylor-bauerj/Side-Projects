<!DOCTYPE html>
<html lang="en">
<head>
	<title> Knockout </title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="css/style.css">
	<link href="https://fonts.googleapis.com/css?family=Allerta+Stencil" rel="stylesheet">
	<style>
		body { font-family: 'Allerta Stencil', sans-serif; }
	</style>
</head>

<body>
	<div id="containerHead">
		<ul class="folders" data-bind="foreach: folders">
			<li data-bind="text: $data, click: $root.goToFolder"></li>
		</ul>
	</div>
	
	<div class="module" id="home">
		<h1> Knockout Learning Home </h1>
	</div>
	
	<div class="module" id="container1">
		<p>First name: <input data-bind="value: firstName" /></p>
		<p>Last name: <input data-bind="value: lastName" /></p>
		<h2>Hello, <span data-bind="text: fullName"> </span>!</h2>
	</div>
	
	<br/>
	
	<div id="container2" class="module">
		<div>
			<span data-bind="text: numberOfClicks"></span>
		</div>
		<button data-bind="click: registerClick">click</button>
	</div>
	
	<br/>
	
	<div id="container3" class="simple-list module">
		<form data-bind="submit: addItem">
			New item:
			<input data-bind="value: itemToAdd, valueUpdate: 'afterkeydown'" />
			<button type="submit" data-bind="enable: itemToAdd().length > 0">Add</button>
			<p>Your items:</p>
			<select class="select1" multiple="multiple" width="50" data-bind="options: items, selectedOptions: selectedItems"></select>
		
			<button data-bind="click: removeItem, enable: selectedItems().length > 0">Remove Item</button>
			<br/><br/>
			<input data-bind="value: itemToEdit" />
			<button data-bind="click: editItem">Edit Item</button>
		</form>
	</div>
	
	<div class="calculatorContainer">
		<div id="calculator" class="module calculator">
			<textarea rows="4" cols="38" disabled="true" data-bind="textInput: equation">
			</textarea><br/>
			
			<button type="button" data-bind="click: function(num) { addToEquation('7', num) } ">7</button>
			<button type="button" data-bind="click: function(num) { addToEquation('8', num) } ">8</button>
			<button type="button" data-bind="click: function(num) { addToEquation('9', num) } ">9</button>
		
			<button type="button" data-bind="click: function(num) { addToEquation('+', num) } ">+</button>
			
			<br/><br/>
			<button type="button" data-bind="click: function(num) { addToEquation('4', num) } ">4</button>
			<button type="button" data-bind="click: function(num) { addToEquation('5', num) } ">5</button>
			<button type="button" data-bind="click: function(num) { addToEquation('6', num) } ">6</button>
			
			<button type="button" data-bind="click: function(num) { addToEquation('-', num) } ">-</button>
			
			<br/><br/>
			<button type="button" data-bind="click: function(num) { addToEquation('1', num) } ">1</button>
			<button type="button" data-bind="click: function(num) { addToEquation('2', num) } ">2</button>
			<button type="button" data-bind="click: function(num) { addToEquation('3', num) } ">3</button>
			<br/><br/>
			<button type="button" data-bind="click: function(num) { addToEquation('0', num) } ">0</button>
			
			
			<button type="button" data-bind="click: clear">Clear</button>
			<button type="button" data-bind="click: evaluate">Equal</button>
			
			<span data-bind="text: answer"></span>
		</div>
	</div>
	
	<div class="lotto-container">
		<div id="lotto-check" class="module lotto-numbers">
				<input type="text" data-bind="value: numbers()[0]" id="num1" class="ball"/>
				<input type="text" data-bind="value: numbers()[1]" id="num2" class="ball"/>
			
				<input type="text" data-bind="value: numbers()[2]" id="num3" class="ball"/>
				<input type="text" data-bind="value: numbers()[3]" id="num4" class="ball"/>
			
				<input type="text" data-bind="value: numbers()[4]" id="num5" class="ball"/>
				
				<br/>
				Extra Number: 
				<input type="text" data-bind="value: extra" id="num6" class="ball"/>
				<br/>
				
				<button type="button" data-bind="click: calculateWinnings">Submit</button>
				<button type="button" data-bind="click: randomize">Random Draw</button>
				<button type="button" data-bind="click: simulate">Simulate</button>
				
				<br/><br/>
				
				<span data-bind="text: result"></span>
				
				<br/>
				Winning Numbers: <span data-bind="text: latestDraw"></span>
				<br/>
				
				<p>Tickets sold: <span data-bind="text: soldTickets"></span></p>
				
				Ticket Selling Speed: 
				<input type="range" min="1" max="100" value="50" data-bind="value: ticketSpeed" 
				style="direction: rtl; margin-left: 50px;" id="speedInput" oninput="speedId.value = speedInput.value">
				<output id="speedId">50</output>
				
				
				<p>$ from tickets: <span data-bind="text: amountFromTickets"></span></p>
				<p>Payout: <span data-bind="text: payout"></span></p>
				<p>Profit: <span data-bind="text: profit"></span></p>
				
				<br/>
				<button type="button" data-bind="click: pause">Pause</button>
				<button type="button" data-bind="click: resume">Resume</button>
				
			
				<br/><br/>
				<div class="toTheSide">
					Winning Tickets:
					<br/>
					<select class="ticketDisplay" multiple="multiple" width="50" data-bind="options: ticketWinners"></select>
					<br/><br/>
					Stats:
					<br/>
					<select multiple="multiple" width="250" size="6">
						<option data-bind="text: stats()[0]"></option>
						<option data-bind="text: stats()[1]"></option>
						<option data-bind="text: stats()[2]"></option>
						<option data-bind="text: stats()[3]"></option>
						<option data-bind="text: stats()[4]"></option>
						<option data-bind="text: stats()[5]"></option>
					</select>
				</div>
		</div>
	</div>

<!-- JQuery JS -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="js/knockout-3.4.2.js"></script>
<script src="js/sammy-latest.min.js"></script>
<script type="text/javascript">
	var ViewModel = function(first, last) {
		var self = this;
		self.firstName = ko.observable(first);
		self.lastName = ko.observable(last);
		self.fullName = ko.computed(function(){
			return self.firstName() + " " + self.lastName();
		});
	};
	
	var ClickModel = function() {
		this.numberOfClicks = ko.observable(0);
		this.registerClick = function() {
			this.numberOfClicks(this.numberOfClicks() + 1);
		};
	};
	
	var SimpleList = function(items) {
		this.items = ko.observableArray(items);
		this.itemToAdd = ko.observable("");
		this.itemToEdit = ko.observable("");
		this.selectedItems = ko.observableArray();
		this.addItem = function() {
			if(this.itemToAdd() != ""){
				this.items.push(this.itemToAdd());
				this.itemToAdd("");
			}
		}.bind(this);
		this.removeItem = function() {
			this.items.removeAll(this.selectedItems());
			this.selectedItems([]);
		}.bind(this);
		this.editItem = function() {
			if(this.itemToEdit() != "" && this.selectedItems().length == 1) {
				this.items.replace(this.selectedItems()[0], this.itemToEdit());
			}
		}.bind(this);
	};
	
	var NavbarModel = function() {
		self = this;
		self.folders = ['Home', 'Name', 'Clicker', 'Shopping List', 'Calculator', 'Lottery Checker'];
		self.chosenFolderId = ko.observable();
		self.chosenFolderData = ko.observable();
		self.goToFolder = function(folder) {
			location.hash = folder;
		};
		Sammy(function() {
			this.get('#Name', function() {
				$('.module').css('display', 'none');
				$('#container1').css('display', 'initial');
			});
			this.get('#Clicker', function() {
				$('.module').css('display', 'none');
				$('#container2').css('display', 'initial');
			});
			this.get('#Shopping%20List', function() {
				$('.module').css('display', 'none');
				$('#container3').css('display', 'initial');
			});
			this.get('#Home', function() {
				$('.module').css('display', 'none');
				$('#home').css('display', 'initial');
			});
			this.get('#Calculator', function() {
				$('.module').css('display', 'none');
				$('#calculator').css('display', 'initial');
			});
			this.get('#Lottery%20Checker', function() {
				$('.module').css('display', 'none');
				$('#lotto-check').css('display', 'initial');
			});
		}).run();
	};
	
	var CalculatorModel = function(d) {
		var self = this;
		self.equation = ko.observableArray("");
		self.answer = ko.observable("");
		self.addToEquation = function(num) {
			var temp = self.equation();
			self.equation(temp + num);
		}
		self.clear = function() {
			self.equation("");
			self.answer("");
		}
		self.evaluate = function() {
			// checks if the first digit is invalid
			if(self.equation()[0] == "+" || self.equation()[self.equation().length - 1] == "+" || 
				self.equation()[self.equation().length - 1] == "-") {
				self.answer("Not a valid format.");
				return;
			}
			var compiledEquation = [];
			var operators = [];
			var length = self.equation().length;
			var position = 0;
			// loops through the equation to compile 2 arrays
			// compiledEquation: the numbers to compute
			// operators: the operators that the numbers will use to calculate
			begin: for(var i = 0; i < length; i++) {
				var eqToAdd = "";
				var curr = self.equation()[i];
				// adds to the operators array by checking if the current digit is an operator
				// does not count the first digit, if a '-' then it is a negative number
				if(self.equation()[i] == '+' || self.equation()[i] == '-' && i != 0) {
					operators[operators.length] = curr;
					if(self.equation()[i+1] == '+' || self.equation()[i+1] == '-') {
						self.answer("Not a valid format.");
						return;
					}
					// do not go to next loop, the operator has been added
					continue;
				}
				// will loop until an operator is found
				for(var j = i; j < length; j++) {
					// only true if it is the first digit. purpose is to check if first number is negative
					var first = false;
					if(j == 0 && self.equation()[j] == '-') first = true;
					// breaks out of loop if an operator is found, adds compiled numbers to compiledEquation array
					if( (self.equation()[j] == '+' || self.equation()[j] == '-') && !first) { 
						compiledEquation[position] = eqToAdd;
						position++;
						i = j - 1;
						break;
					}
					eqToAdd += self.equation()[j];
					// checks if on the last number, breaks out of loops
					if(j == length - 1) {
						compiledEquation[position] = eqToAdd;
						break begin;
					}
				}
			}
			var answer = 0;
			// if no operators were added
			if(operators.length == 0) {
				self.answer("The answer is: " + compiledEquation[0]);
				return;
			}
			// looks at operators array and determines how the numbers should be calculated 
			for(var i = 0; i < operators.length; i++) {
				var op = operators[i];
				if(op == '+') answer = parseInt(compiledEquation[0]) + parseInt(compiledEquation[1]);
				else if(op == '-') answer = parseInt(compiledEquation[0]) - parseInt(compiledEquation[1]);
				// removes first element of compiledEquation array, replaces with last calculated number
				compiledEquation.shift();
				compiledEquation[0] = answer.toString();
			}
			self.answer("The answer is: " + answer);
			self.equation(self.equation() + "\n" + compiledEquation[0]);
		}
		
	};
	
	var lotteryModel = function() {
		var self = this;
		self.numbers = ko.observableArray();
		self.extra = ko.observable();
		self.result = ko.observable();
		self.latestDraw = [5, 29, 34, 53, 57, 24];
		
		self.winningAmount = 0;
		self.amountOfTickets = 0;
		self.soldTickets = ko.observable(0);
		self.amountFromTickets = ko.observable(0);
		self.payout = ko.observable(0);
		self.profit = ko.observable(0);
		self.ticketWinners = ko.observableArray();
		
		self.ticketSpeed = ko.observable(50);
		
		self.stats = ko.observableArray(["$4: 0", "$7: 0", "$100: 0", "$1,000,000: 0", "JACKPOT: 0", "Overall: 0"]);
		
		var amountOfDollarsWon = [0, 0, 0, 0, 0];
		
		var looping = false;
		var numberOfWinners = 0;
		
		self.calculateWinnings = function() {
		
			var extra = false;
			var amountCorrect = 0;
			// array to test if there are duplicates in submission
			var counts = [];
			self.numbers.sort();
			if(self.numbers().length == 0){
				self.result("Please enter all numbers");
				return;
			}
		
			for(var i = 0; i < self.numbers().length; i++) {
				if(counts[self.numbers()[i]] === undefined) {
					counts[self.numbers()[i]] = 1;
				}
				else {
					self.result("No duplicates can be done.");
					return;
				}
			
				if(self.numbers()[i] == null) {
					self.result("Please enter all numbers.");
					return;
				}
				else if(isNaN(parseInt(self.numbers()[i])) || 
				parseInt(self.numbers()[i]) < 1 || parseInt(self.numbers()[i]) > 69) {
					self.result("Please enter valid numbers.");
					return;
				}
				else if(self.latestDraw.includes(parseInt(self.numbers()[i])))
					amountCorrect++;
			}
			
			if(self.extra() === undefined) {
				self.result("Put in that extra number!");
				return;
			}
			
			// after validation, do calculation
			if(self.extra() == parseInt(self.latestDraw[5]))
				extra = true;
			
			var amountWon = 0;
			
			switch(amountCorrect) {
				case 0:
					if(extra) amountWon = 4;
					break;
				case 1:
					if(extra) amountWon = 4;
					break;
				case 2:
					if(extra) amountWon = 7;
					break;
				case 3:	
					if(extra) amountWon = 100;
					else amountWon = 7;
					break;
				case 4:
					amountWon = 100;
					break;
				case 5:
					if(extra) amountWon = 50000000;
					else amountWon = 1000000;
					break;
				default:
					amountWon = 0;
			}
			
			
			var reduction = [];
			
			switch(amountWon) {
				case 4:
					amountOfDollarsWon[0] += 1;
					reduction = reduce(amountOfDollarsWon[0], self.soldTickets());
					self.stats.replace(self.stats()[0], "$4: " + reduction[0] + "/" + reduction[1]);
					break;
				case 7:
					amountOfDollarsWon[1] += 1;
					reduction = reduce(amountOfDollarsWon[1], self.soldTickets());
					self.stats.replace(self.stats()[1], "$7: " + reduction[0] + "/" + reduction[1]);
					break;
				case 100:
					amountOfDollarsWon[2] += 1;
					reduction = reduce(amountOfDollarsWon[2], self.soldTickets());
					self.stats.replace(self.stats()[2], "$100: " + reduction[0] + "/" + reduction[1]);
					break;
				case 1000000:
					amountOfDollarsWon[3] += 1;
					reduction = reduce(amountOfDollarsWon[3], self.soldTickets());
					self.stats.replace(self.stats()[3], "$1,000,000: " + reduction[0] + "/" + reduction[1]);
					break;
				case 50000000:
					amountOfDollarsWon[4] += 1;
					reduction = reduce(amountOfDollarsWon[4], self.soldTickets());
					self.stats.replace(self.stats()[4], "JACKPOT: " + reduction[0] + "/" + reduction[1]);
					break;
				default:
				
			}
			
			
			
			self.result("You won $" + amountWon + "!");
			self.winningAmount = amountWon;
			
			self.soldTickets(self.soldTickets() + 1);
			if(amountWon > 0){ 
				self.ticketWinners.push("#" + self.soldTickets() + ": $" + amountWon);
				numberOfWinners++;
			}
			
			reduction = reduce(numberOfWinners, self.soldTickets());
			self.stats.replace(self.stats()[5], "Overall: " + reduction[0] + "/" + reduction[1]);
			
			self.amountFromTickets(self.amountFromTickets() + 2);
			self.payout(self.payout() + amountWon);
			self.profit(self.amountFromTickets() - self.payout());
			
			var $sel = $('.ticketDisplay');
			$sel[0].scrollTop = $sel[0].scrollHeight;
			
			if(looping) setTimeout(function(){ self.randomize(); }, self.ticketSpeed() * 2);
		}
		
		self.randomize = function() {
			var random = 0;
			var count = [];
			
			for(var i = 1; i < 6; i++) {
				random = Math.floor(Math.random() * 69) + 1;
				if(count[random] === undefined){
					document.getElementById('num'+i).value = random;
					self.numbers()[i-1] = random;
					count[random] = 1;
				}
				else {
					i--;
					continue;
				}
			}
			
			random = Math.floor(Math.random() * 26) + 1;
			document.getElementById('num6').value = random;
			self.extra(random);
			
			self.calculateWinnings();
		}
		
		self.pause = function() {
			looping = false;
		}
		
		self.resume = function() {
			looping = true;
			self.randomize();
		}
		
		self.simulate = function() {
			looping = true;
			self.randomize();
		}
		
	
		
	};
	
	var shopping = new SimpleList(["A","B","C"]);
	ko.applyBindings(new ViewModel("first", "last"), document.getElementById("container1"));
	ko.applyBindings(new ClickModel(), document.getElementById("container2"));
	ko.applyBindings(shopping, document.getElementById("container3"));
	ko.applyBindings(new CalculatorModel(), document.getElementById("calculator"));
	ko.applyBindings(new lotteryModel(), document.getElementById("lotto-check"));
	
	ko.applyBindings(new NavbarModel(), document.getElementById("containerHead"));
	
	var jsonData = ko.toJSON(shopping);
	var parsedJson = JSON.parse(jsonData);
	
	/*var requestURL = 'https://github.com/taylor-bauerj/Side-Projects/blob/master/ko%20learning/data.json';
	
	var request = new XMLHttpRequest();
	request.open('GET', requestURL);
	request.responseType = 'json';
	request.send();
	
	request.onload = function() {
		console.log(request.response);
	}*/
	
	function updateTextInput(val) {
		document.getElementById('speedValue').value = val;
	}
	
	function reduce(numerator, denominator) {
		var gcd = function gcd(a, b) {
			return b ? gcd(b, a%b) : a;
		}
		gcd = gcd(numerator, denominator);
		return [numerator/gcd, denominator/gcd];
	}
</script>
</body>

</html>