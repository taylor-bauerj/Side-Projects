<!DOCTYPE html>
<html lang="en">
<head>
	<title> Knockout </title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="css/style.css">
</head>

<body>
	<div id="containerHead">
		<ul class="folders" data-bind="foreach: folders">
			<li data-bind="text: $data, click: $root.goToFolder"></li>
		</ul>
	</div>
	
	<div class="module" id="home">
		<h1> Knockout Learning Home </h1>
	</div>
	
	<div class="module" id="container1">
		<p>First name: <input data-bind="value: firstName" /></p>
		<p>Last name: <input data-bind="value: lastName" /></p>
		<h2>Hello, <span data-bind="text: fullName"> </span>!</h2>
	</div>
	
	<br/>
	
	<div id="container2" class="module">
		<div>
			<span data-bind="text: numberOfClicks"></span>
		</div>
		<button data-bind="click: registerClick">click</button>
	</div>
	
	<br/>
	
	<div id="container3" class="simple-list module">
		<form data-bind="submit: addItem">
			New item:
			<input data-bind="value: itemToAdd, valueUpdate: 'afterkeydown'" />
			<button type="submit" data-bind="enable: itemToAdd().length > 0">Add</button>
			<p>Your items:</p>
			<select class="select1" multiple="multiple" width="50" data-bind="options: items, selectedOptions: selectedItems"></select>
		
			<button data-bind="click: removeItem, enable: selectedItems().length > 0">Remove Item</button>
			<br/><br/>
			<input data-bind="value: itemToEdit" />
			<button data-bind="click: editItem">Edit Item</button>
		</form>
	</div>
	
	<div class="calculatorContainer">
	<div id="calculator" class="module calculator">
		<textarea rows="4" cols="38" disabled="true" data-bind="textInput: equation">
		</textarea><br/>
		
		<button type="button" data-bind="click: function(num) { addToEquation('7', num) } ">7</button>
		<button type="button" data-bind="click: function(num) { addToEquation('8', num) } ">8</button>
		<button type="button" data-bind="click: function(num) { addToEquation('9', num) } ">9</button>
	
		<button type="button" data-bind="click: function(num) { addToEquation('+', num) } ">+</button>
		
		<br/><br/>
		<button type="button" data-bind="click: function(num) { addToEquation('4', num) } ">4</button>
		<button type="button" data-bind="click: function(num) { addToEquation('5', num) } ">5</button>
		<button type="button" data-bind="click: function(num) { addToEquation('6', num) } ">6</button>
		
		<button type="button" data-bind="click: function(num) { addToEquation('-', num) } ">-</button>
		
		<br/><br/>
		<button type="button" data-bind="click: function(num) { addToEquation('1', num) } ">1</button>
		<button type="button" data-bind="click: function(num) { addToEquation('2', num) } ">2</button>
		<button type="button" data-bind="click: function(num) { addToEquation('3', num) } ">3</button>
		<br/><br/>
		<button type="button" data-bind="click: function(num) { addToEquation('0', num) } ">0</button>
		
		
		<button type="button" data-bind="click: clear">Clear</button>
		<button type="button" data-bind="click: evaluate">Equal</button>
		
		<span data-bind="text: answer"></span>
	</div>
	</div>

<!-- JQuery JS -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="js/knockout-3.4.2.js"></script>
<script src="js/sammy-latest.min.js"></script>
<script type="text/javascript">
	var ViewModel = function(first, last) {
		var self = this;
		self.firstName = ko.observable(first);
		self.lastName = ko.observable(last);
		self.fullName = ko.computed(function(){
			return self.firstName() + " " + self.lastName();
		});
	};
	
	var ClickModel = function() {
		this.numberOfClicks = ko.observable(0);
		this.registerClick = function() {
			this.numberOfClicks(this.numberOfClicks() + 1);
		};
	};
	
	var SimpleList = function(items) {
		this.items = ko.observableArray(items);
		this.itemToAdd = ko.observable("");
		this.itemToEdit = ko.observable("");
		this.selectedItems = ko.observableArray();
		this.addItem = function() {
			if(this.itemToAdd() != ""){
				this.items.push(this.itemToAdd());
				this.itemToAdd("");
			}
		}.bind(this);
		this.removeItem = function() {
			this.items.removeAll(this.selectedItems());
			this.selectedItems([]);
		}.bind(this);
		this.editItem = function() {
			if(this.itemToEdit() != "" && this.selectedItems().length == 1) {
				this.items.replace(this.selectedItems()[0], this.itemToEdit());
			}
		}.bind(this);
	};
	
	var NavbarModel = function() {
		self = this;
		self.folders = ['Home', 'Name', 'Clicker', 'Shopping List', 'Calculator'];
		self.chosenFolderId = ko.observable();
		self.chosenFolderData = ko.observable();
		self.goToFolder = function(folder) {
			location.hash = folder;
		};
		Sammy(function() {
			this.get('#Name', function() {
				$('.module').css('display', 'none');
				$('#container1').css('display', 'initial');
			});
			this.get('#Clicker', function() {
				$('.module').css('display', 'none');
				$('#container2').css('display', 'initial');
			});
			this.get('#Shopping%20List', function() {
				$('.module').css('display', 'none');
				$('#container3').css('display', 'initial');
			});
			this.get('#Home', function() {
				$('.module').css('display', 'none');
				$('#home').css('display', 'initial');
			});
			this.get('#Calculator', function() {
				$('.module').css('display', 'none');
				$('#calculator').css('display', 'initial');
			});
		}).run();
	};
	
	var CalculatorModel = function(d) {
		var self = this;
		self.equation = ko.observableArray("");
		self.answer = ko.observable("");
		self.addToEquation = function(num) {
			var temp = self.equation();
			self.equation(temp + num);
		}
		self.clear = function() {
			self.equation("");
			self.answer("");
		}
		self.evaluate = function() {
			// checks if the first digit is invalid
			if(self.equation()[0] == "+" || self.equation()[self.equation().length - 1] == "+" || 
				self.equation()[self.equation().length - 1] == "-") {
				self.answer("Not a valid format.");
				return;
			}
			var compiledEquation = [];
			var operators = [];
			var length = self.equation().length;
			var position = 0;
			// loops through the equation to compile 2 arrays
			// compiledEquation: the numbers to compute
			// operators: the operators that the numbers will use to calculate
			begin: for(var i = 0; i < length; i++) {
				var eqToAdd = "";
				var curr = self.equation()[i];
				// adds to the operators array by checking if the current digit is an operator
				// does not count the first digit, if a '-' then it is a negative number
				if(self.equation()[i] == '+' || self.equation()[i] == '-' && i != 0) {
					operators[operators.length] = curr;
					if(self.equation()[i+1] == '+' || self.equation()[i+1] == '-') {
						self.answer("Not a valid format.");
						return;
					}
					// do not go to next loop, the operator has been added
					continue;
				}
				// will loop until an operator is found
				for(var j = i; j < length; j++) {
					// only true if it is the first digit. purpose is to check if first number is negative
					var first = false;
					if(j == 0 && self.equation()[j] == '-') first = true;
					// breaks out of loop if an operator is found, adds compiled numbers to compiledEquation array
					if( (self.equation()[j] == '+' || self.equation()[j] == '-') && !first) { 
						compiledEquation[position] = eqToAdd;
						position++;
						i = j - 1;
						break;
					}
					eqToAdd += self.equation()[j];
					// checks if on the last number, breaks out of loops
					if(j == length - 1) {
						compiledEquation[position] = eqToAdd;
						break begin;
					}
				}
			}
			var answer = 0;
			// if no operators were added
			if(operators.length == 0) {
				self.answer("The answer is: " + compiledEquation[0]);
				return;
			}
			// looks at operators array and determines how the numbers should be calculated 
			for(var i = 0; i < operators.length; i++) {
				var op = operators[i];
				if(op == '+') answer = parseInt(compiledEquation[0]) + parseInt(compiledEquation[1]);
				else if(op == '-') answer = parseInt(compiledEquation[0]) - parseInt(compiledEquation[1]);
				// removes first element of compiledEquation array, replaces with last calculated number
				compiledEquation.shift();
				compiledEquation[0] = answer.toString();
			}
			self.answer("The answer is: " + answer);
			self.equation(self.equation() + "\n" + compiledEquation[0]);
		}
	};
	
	var shopping = new SimpleList(["A","B","C"]);
	ko.applyBindings(new ViewModel("first", "last"), document.getElementById("container1"));
	ko.applyBindings(new ClickModel(), document.getElementById("container2"));
	ko.applyBindings(shopping, document.getElementById("container3"));
	ko.applyBindings(new CalculatorModel(), document.getElementById("calculator"));
	ko.applyBindings(new NavbarModel(), document.getElementById("containerHead"));
	
	var jsonData = ko.toJSON(shopping);
	var parsedJson = JSON.parse(jsonData);
	
	/*var requestURL = 'https://github.com/taylor-bauerj/Side-Projects/blob/master/ko%20learning/data.json';
	
	var request = new XMLHttpRequest();
	request.open('GET', requestURL);
	request.responseType = 'json';
	request.send();
	
	request.onload = function() {
		console.log(request.response);
	}*/
</script>
</body>

</html>